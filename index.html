<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Shapelocker by panespanes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Shapelocker</h1>
      <h2 class="project-tagline">PATTERN LOCK, unlock using gestures (手势解锁,九宫格解锁,图形解锁)</h2>
      <a href="https://github.com/panespanes/ShapeLocker" class="btn">View on GitHub</a>
      <a href="https://github.com/panespanes/ShapeLocker/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/panespanes/ShapeLocker/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="shapelocker" class="anchor" href="#shapelocker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ShapeLocker</h1>

<p>PATTERN LOCK, unlock with gestures<br>
(手势解锁,九宫格解锁,图形解锁)<br><br>
<img src="https://github.com/panespanes/ShapeLocker/blob/master/mdp1.png" alt="image">
<br>
<br>
<br></p>

<h2>
<a id="download" class="anchor" href="#download" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Download</h2>

<p>You can download a jar from GitHub's [releases page][1].</p>

<p>Or use Gradle:</p>

<div class="highlight highlight-source-groovy-gradle"><pre><span class="pl-en">repositories</span> {
  mavenCentral() <span class="pl-c">// jcenter() also works</span>
}

<span class="pl-en">dependencies</span> {
  compile <span class="pl-s"><span class="pl-pds">'</span>com.panes.shapelocker:1.0.2<span class="pl-pds">'</span></span>
}</pre></div>

<p><br></p>

<h2>
<a id="how-to-use" class="anchor" href="#how-to-use" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How to Use</h2>

<p>Simple use case: </p>

<p>in layout.xml: </p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// To create a simple view:</span>
    <span class="pl-k">&lt;</span><span class="pl-smi">com.panes.shapelocker.view<span class="pl-k">.</span>ShapeLocker</span>
        android<span class="pl-k">:</span>id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>@+id/sl<span class="pl-pds">"</span></span>
        xmlns<span class="pl-k">:</span>android<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>http://schemas.android.com/apk/res/android<span class="pl-pds">"</span></span>
        android<span class="pl-k">:</span>layout_width<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>match_parent<span class="pl-pds">"</span></span>
        android<span class="pl-k">:</span>layout_height<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>match_parent<span class="pl-pds">"</span></span>
        android<span class="pl-k">:</span>background<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>@android:color/darker_gray<span class="pl-pds">"</span></span>
        <span class="pl-k">&gt;</span>

    <span class="pl-k">&lt;</span><span class="pl-k">/</span><span class="pl-smi">com.panes.shapelocker.view<span class="pl-k">.</span>ShapeLocker</span><span class="pl-k">&gt;</span></pre></div>

<p>More configurations:</p>

<div class="highlight highlight-source-java"><pre>
@<span class="pl-smi">Override</span>
    <span class="pl-k">protected</span> <span class="pl-k">void</span> onCreate(<span class="pl-smi">Bundle</span> savedInstanceState) {
        <span class="pl-v">super</span><span class="pl-k">.</span>onCreate(savedInstanceState);
        setContentView(<span class="pl-smi">R</span><span class="pl-k">.</span>layout<span class="pl-k">.</span>sp);

        <span class="pl-c">// load a default theme:</span>
        <span class="pl-smi">ShapeLockerProperties</span><span class="pl-k">.</span>with(<span class="pl-v">this</span>)<span class="pl-k">.</span>loadLightTheme();
        <span class="pl-c">// or:</span>
        <span class="pl-smi">ShapeLocker</span> sl <span class="pl-k">=</span> (<span class="pl-smi">ShapeLocker</span>) findViewById(<span class="pl-smi">R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>sl);
        sl<span class="pl-k">.</span>loadLightTheme();


    }</pre></div>

<p><br></p>

<h2>
<a id="unsolved" class="anchor" href="#unsolved" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>UNSOLVED:</h2>

<p>模拟器上运行的bug (真机上运行没影响)<br>
 有同学反映<strong><em>模拟器上运行</em></strong>会出现"密码圈绘制不全"的bug, 如图<br></p>

<p><img src="https://github.com/panespanes/ShapeLocker/blob/master/mdp.png" alt="image">
 <br>
 做了些实验, 真机不会出现这个bug, AVD自带模拟器没有重现, BlueStacks模拟器没有类似情况,<br> 而"靠谱助手","海马玩","逍遥模拟器"等VirtualBox底层的模拟器均重现bug.<br>
 猜测是由于VirtualBox的驱动对于安卓UI图形绘制的支持并不全面导致的:<br>
 具体原因ShapeLocker对界面刷新做了优化, 响应触摸事件后<strong><em>只重绘被影响区域</em></strong>,<br> 
 相关代码:   </p>

<div class="highlight highlight-source-java"><pre>
 <span class="pl-smi">Rect</span> invalidateRect <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Rect</span>();
 <span class="pl-c1">...</span>
 invalidateRect<span class="pl-k">.</span>set((<span class="pl-k">int</span>) (left <span class="pl-k">-</span> radius), (<span class="pl-k">int</span>) (top <span class="pl-k">-</span> radius), (<span class="pl-k">int</span>) (right <span class="pl-k">+</span> radius), (<span class="pl-k">int</span>) (bottom <span class="pl-k">+</span> radius));
 <span class="pl-c1">...</span>
 invalidateRect<span class="pl-k">.</span>union((<span class="pl-k">int</span>) (left <span class="pl-k">-</span> radius), (<span class="pl-k">int</span>) (top <span class="pl-k">-</span> radius), (<span class="pl-k">int</span>) (right <span class="pl-k">+</span> radius), (<span class="pl-k">int</span>) (bottom <span class="pl-k">+</span> radius));
 <span class="pl-c1">...</span>
 invalidateRect<span class="pl-k">.</span>set((<span class="pl-k">int</span>) (left <span class="pl-k">-</span> widthOffset), (<span class="pl-k">int</span>) (top <span class="pl-k">-</span> heightOffset), (<span class="pl-k">int</span>) (right <span class="pl-k">+</span> widthOffset), (<span class="pl-k">int</span>) (bottom <span class="pl-k">+</span> heightOffset));
 <span class="pl-c1">...</span>
 invalidate(invalidateRect);
</pre></div>

<p>而VirtualBox并不会按照严格按照rect大小重绘区域.<br>
 解决办法(真机运行的项目中请不要这样修改, 因为会造成平均34%左右性能损失):<br>
 将这部分代码改为</p>

<div class="highlight highlight-source-java"><pre>invalidate();</pre></div>

<p>即可.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/panespanes/ShapeLocker">Shapelocker</a> is maintained by <a href="https://github.com/panespanes">panespanes</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
